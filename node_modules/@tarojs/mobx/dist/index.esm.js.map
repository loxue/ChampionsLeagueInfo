{"version":3,"file":"index.esm.js","sources":["../src/store.js","../src/observer.js","../src/inject.js","../src/index.js"],"sourcesContent":["let store = {}\n\nexport function getStore () {\n  return store\n}\n\nexport function setStore (arg) {\n  store = arg\n}\n","import { Reaction, _allowStateChanges } from 'mobx'\n\nfunction isStateless (component) {\n  return !(component.prototype && component.prototype._createData)\n}\n\nexport function observer (Component) {\n  if (typeof Component !== 'function' || isStateless(Component)) {\n    throw new Error(\"Please pass a valid component to 'observer'\")\n  }\n\n  if (Component.isMobxInjector === true) {\n    console.warn(\n      \"Mobx observer: You are trying to use 'observer' on a component that already has 'inject'. Please apply 'observer' before applying 'inject'\"\n    )\n  }\n\n  class ObserverComponent extends Component {\n    componentWillMount () {\n      const initialName =\n            this.displayName ||\n            this.name ||\n            (this.constructor && (this.constructor.displayName || this.constructor.name)) ||\n            '<component>'\n      this._reaction = new Reaction(`${initialName}_${Date.now()}`, () => {\n        if (typeof this.componentWillReact === 'function') {\n          this.componentWillReact()\n        }\n        this.forceUpdate()\n      })\n      if (typeof super.componentWillMount === 'function') {\n        super.componentWillMount()\n      }\n    }\n\n    componentWillUnmount () {\n      this._reaction.dispose()\n      if (typeof super.componentWillUnmount === 'function') {\n        super.componentWillUnmount()\n      }\n    }\n  }\n\n  const target = ObserverComponent.prototype\n  const originCreateData = target._createData\n  target._createData = function () {\n    let result\n    let exception\n    if (this._reaction && this._reaction instanceof Reaction) {\n      this._reaction.track(() => {\n        try {\n          result = _allowStateChanges(false, originCreateData.bind(this))\n        } catch (e) {\n          exception = e\n        }\n      })\n    } else {\n      result = originCreateData.call(this)\n    }\n    if (exception) {\n      throw exception\n    }\n    return result\n  }\n\n  return ObserverComponent\n}\n","import { getStore } from './store'\n\nfunction mapStoreToProps (grabStoresFn, props) {\n  let newProps = {}\n  for (let key in props) {\n    if (props.hasOwnProperty(key)) {\n      newProps[key] = props[key]\n    }\n  }\n  const additionalProps = grabStoresFn(getStore() || {}, newProps) || {}\n  for (let key in additionalProps) {\n    newProps[key] = additionalProps[key]\n  }\n  return newProps\n}\n\nfunction createStoreInjector (grabStoresFn, injectNames, Component) {\n  let displayName =\n        'inject-' +\n        (Component.displayName ||\n          Component.name ||\n            (Component.constructor && Component.constructor.name) ||\n            'Unknown')\n  if (injectNames) {\n    displayName += '-with-' + injectNames\n  }\n\n  class Injector extends Component {\n    static isMobxInjector = true\n    static displayName = displayName\n    constructor (props) {\n      super(Object.assign(...arguments, mapStoreToProps(grabStoresFn, props)))\n    }\n\n    componentWillMount () {\n      Object.assign(this.props, mapStoreToProps(grabStoresFn, this.props))\n      if (typeof super.componentWillMount === 'function') {\n        super.componentWillMount()\n      }\n    }\n  }\n  const target = Injector.prototype\n  const originCreateData = target._createData\n  target._createData = function () {\n    Object.assign(this.props, mapStoreToProps(grabStoresFn, this.props))\n    return originCreateData.call(this)\n  }\n  return Injector\n}\n\nfunction grabStoresByName (storeNames) {\n  return function (baseStores, nextProps) {\n    storeNames.forEach(function (storeName) {\n      if (!(storeName in baseStores)) {\n        throw new Error(\n          \"MobX injector: Store '\" +\n                        storeName +\n                        \"' is not available! Make sure it is provided by some Provider\"\n        )\n      }\n      nextProps[storeName] = baseStores[storeName]\n    })\n    return nextProps\n  }\n}\n\nexport function inject (/* fn(stores, nextProps) or ...storeNames */) {\n  let grabStoresFn\n  if (typeof arguments[0] === 'function') {\n    grabStoresFn = arguments[0]\n    return function (componentClass) {\n      return createStoreInjector(grabStoresFn, null, componentClass)\n    }\n  } else {\n    const storeNames = []\n    for (let i = 0; i < arguments.length; i++) storeNames[i] = arguments[i]\n    grabStoresFn = grabStoresByName(storeNames)\n    return function (componentClass) {\n      return createStoreInjector(grabStoresFn, storeNames.join('-'), componentClass)\n    }\n  }\n}\n","import { getStore, setStore } from './store'\nimport { observer } from './observer'\nimport { inject } from './inject'\n\nclass Provider {}\n\nexport default {\n  getStore,\n  setStore,\n  observer,\n  inject,\n  Provider\n}\n\nexport {\n  getStore,\n  setStore,\n  observer,\n  inject,\n  Provider\n}\n"],"names":["store","getStore","setStore","arg","isStateless","component","prototype","_createData","observer","Component","Error","isMobxInjector","console","warn","ObserverComponent","initialName","displayName","name","constructor","_reaction","Reaction","Date","now","componentWillReact","forceUpdate","dispose","target","originCreateData","result","exception","track","_allowStateChanges","bind","e","call","mapStoreToProps","grabStoresFn","props","newProps","key","hasOwnProperty","additionalProps","createStoreInjector","injectNames","Injector","Object","assign","arguments","grabStoresByName","storeNames","baseStores","nextProps","forEach","storeName","inject","componentClass","i","length","join","Provider"],"mappings":"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"}