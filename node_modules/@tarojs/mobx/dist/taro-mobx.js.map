{"version":3,"file":"taro-mobx.js","sources":["../src/store.js","../src/observer.js","../src/inject.js","../src/index.js"],"sourcesContent":["let store = {}\n\nexport function getStore () {\n  return store\n}\n\nexport function setStore (arg) {\n  store = arg\n}\n","import { Reaction, _allowStateChanges } from 'mobx'\n\nfunction isStateless (component) {\n  return !(component.prototype && component.prototype._createData)\n}\n\nexport function observer (Component) {\n  if (typeof Component !== 'function' || isStateless(Component)) {\n    throw new Error(\"Please pass a valid component to 'observer'\")\n  }\n\n  if (Component.isMobxInjector === true) {\n    console.warn(\n      \"Mobx observer: You are trying to use 'observer' on a component that already has 'inject'. Please apply 'observer' before applying 'inject'\"\n    )\n  }\n\n  class ObserverComponent extends Component {\n    componentWillMount () {\n      const initialName =\n            this.displayName ||\n            this.name ||\n            (this.constructor && (this.constructor.displayName || this.constructor.name)) ||\n            '<component>'\n      this._reaction = new Reaction(`${initialName}_${Date.now()}`, () => {\n        if (typeof this.componentWillReact === 'function') {\n          this.componentWillReact()\n        }\n        this.forceUpdate()\n      })\n      if (typeof super.componentWillMount === 'function') {\n        super.componentWillMount()\n      }\n    }\n\n    componentWillUnmount () {\n      this._reaction.dispose()\n      if (typeof super.componentWillUnmount === 'function') {\n        super.componentWillUnmount()\n      }\n    }\n  }\n\n  const target = ObserverComponent.prototype\n  const originCreateData = target._createData\n  target._createData = function () {\n    let result\n    let exception\n    if (this._reaction && this._reaction instanceof Reaction) {\n      this._reaction.track(() => {\n        try {\n          result = _allowStateChanges(false, originCreateData.bind(this))\n        } catch (e) {\n          exception = e\n        }\n      })\n    } else {\n      result = originCreateData.call(this)\n    }\n    if (exception) {\n      throw exception\n    }\n    return result\n  }\n\n  return ObserverComponent\n}\n","import { getStore } from './store'\n\nfunction mapStoreToProps (grabStoresFn, props) {\n  let newProps = {}\n  for (let key in props) {\n    if (props.hasOwnProperty(key)) {\n      newProps[key] = props[key]\n    }\n  }\n  const additionalProps = grabStoresFn(getStore() || {}, newProps) || {}\n  for (let key in additionalProps) {\n    newProps[key] = additionalProps[key]\n  }\n  return newProps\n}\n\nfunction createStoreInjector (grabStoresFn, injectNames, Component) {\n  let displayName =\n        'inject-' +\n        (Component.displayName ||\n          Component.name ||\n            (Component.constructor && Component.constructor.name) ||\n            'Unknown')\n  if (injectNames) {\n    displayName += '-with-' + injectNames\n  }\n\n  class Injector extends Component {\n    static isMobxInjector = true\n    static displayName = displayName\n    constructor (props) {\n      super(Object.assign(...arguments, mapStoreToProps(grabStoresFn, props)))\n    }\n\n    componentWillMount () {\n      Object.assign(this.props, mapStoreToProps(grabStoresFn, this.props))\n      if (typeof super.componentWillMount === 'function') {\n        super.componentWillMount()\n      }\n    }\n  }\n  const target = Injector.prototype\n  const originCreateData = target._createData\n  target._createData = function () {\n    Object.assign(this.props, mapStoreToProps(grabStoresFn, this.props))\n    return originCreateData.call(this)\n  }\n  return Injector\n}\n\nfunction grabStoresByName (storeNames) {\n  return function (baseStores, nextProps) {\n    storeNames.forEach(function (storeName) {\n      if (!(storeName in baseStores)) {\n        throw new Error(\n          \"MobX injector: Store '\" +\n                        storeName +\n                        \"' is not available! Make sure it is provided by some Provider\"\n        )\n      }\n      nextProps[storeName] = baseStores[storeName]\n    })\n    return nextProps\n  }\n}\n\nexport function inject (/* fn(stores, nextProps) or ...storeNames */) {\n  let grabStoresFn\n  if (typeof arguments[0] === 'function') {\n    grabStoresFn = arguments[0]\n    return function (componentClass) {\n      return createStoreInjector(grabStoresFn, null, componentClass)\n    }\n  } else {\n    const storeNames = []\n    for (let i = 0; i < arguments.length; i++) storeNames[i] = arguments[i]\n    grabStoresFn = grabStoresByName(storeNames)\n    return function (componentClass) {\n      return createStoreInjector(grabStoresFn, storeNames.join('-'), componentClass)\n    }\n  }\n}\n","import { getStore, setStore } from './store'\nimport { observer } from './observer'\nimport { inject } from './inject'\n\nclass Provider {}\n\nexport default {\n  getStore,\n  setStore,\n  observer,\n  inject,\n  Provider\n}\n\nexport {\n  getStore,\n  setStore,\n  observer,\n  inject,\n  Provider\n}\n"],"names":["store","getStore","setStore","arg","isStateless","component","prototype","_createData","observer","Component","Error","isMobxInjector","console","warn","ObserverComponent","initialName","displayName","name","constructor","_reaction","Reaction","Date","now","componentWillReact","forceUpdate","dispose","target","originCreateData","result","exception","track","_allowStateChanges","bind","e","call","mapStoreToProps","grabStoresFn","props","newProps","key","hasOwnProperty","additionalProps","createStoreInjector","injectNames","Injector","Object","assign","arguments","grabStoresByName","storeNames","baseStores","nextProps","forEach","storeName","inject","componentClass","i","length","join","Provider"],"mappings":"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"}